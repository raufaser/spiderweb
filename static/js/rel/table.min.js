class table_builder{constructor(e){this.selector=e,this.current_data=[],this.first_time=!0}getLastRowId(){let e;return e=null==this.current_data||this.current_data.length<1?0:this.current_data[0].rowid}resetData(){this.current_data=[]}#buildRow(e,t,n,a=""){var r=document.createElement("tr"),t=(0<a.length||t&&!this.first_time&&(r.className="table-info"),document.createElement("i")),l=(t.className="bi-search",t.role="button",t.ariaLabel=e.de,document.createElement("a")),o=(l.href=qrz_url+e.de,l.target="_blank",l.rel="noopener",document.createElement("span")),d=(e.de==a?((d=document.createElement("mark")).textContent=e.de,o.appendChild(d)):o.textContent=" "+e.de,document.createElement("td")),t=(d.className="d-none d-lg-table-cell d-xl-table-cell",l.appendChild(t),d.appendChild(l),d.appendChild(o),r.append(d),Intl.NumberFormat("it-IT",{style:"decimal"}).format(e.freq)),l=document.createElement("span"),o=(l.className="badge text-bg-warning badge-responsive",l.textContent=t,document.createElement("td")),d=(o.appendChild(l),r.appendChild(o),findAdxo(my_adxo_events,e.dx)),t="<a href="+adxo_url+" target=_blank rel=noopener >NG3K Website</a>",l=document.createElement("i"),o=(l.className="bi-search",l.role="button",l.ariaLabel=e.dx,document.createElement("a")),s=(o.href=qrz_url+e.dx,o.target="_blank",o.rel="noopener",document.createElement("span")),c=document.createElement("mark"),c=(c.textContent=e.dx,e.dx==a?s.appendChild(c):s.textContent=" "+e.dx,null!=d&&((a=document.createElement("i")).tabIndex=0,a.className="bi-megaphone-fill",a.style="color: cornflowerblue;",a.role="button",a.ariaLabel="dx_operations",a.setAttribute("data-bs-container","body"),a.setAttribute("data-bs-toggle","popover"),a.setAttribute("data-bs-trigger","focus"),a.setAttribute("data-bs-sanitizer","true"),a.setAttribute("data-bs-placement","auto"),a.setAttribute("data-bs-html","true"),a.setAttribute("data-bs-title","Announced DX Op.: "+d.summary),a.setAttribute("data-bs-content",d.description+"data from  "+t),s.appendChild(a)),document.createElement("td"));o.appendChild(l),c.appendChild(o),c.append(s),r.appendChild(c);try{var i=document.createElement("span"),p=(i.className="img-flag fi fi-"+e.iso,i.setAttribute("data-bs-container","body"),i.setAttribute("data-bs-toggle","popover"),i.setAttribute("data-bs-trigger","hover"),i.setAttribute("data-bs-placement","left"),i.setAttribute("data-bs-content",e.country),document.createElement("td"));p.appendChild(i),r.appendChild(p)}catch(e){console.log(e),console.log("error creating flag");d=document.createElement("td");r.appendChild(d)}var u,t=document.createElement("td"),a=(t.className="d-none d-lg-table-cell d-xl-table-cell",t.textContent=e.country,r.appendChild(t),document.createElement("td")),m=document.createElement("table");for(u of e.references){var h=document.createElement("tr"),b=document.createElement("td"),g=document.createElement("span"),g=(g.className="badge badge-responsive-pac rounded-pill",g.className+=" badge-"+u[0].toLowerCase(),g.textContent=u[0],b.appendChild(g),document.createElement("span")),g=(g.textContent=u[1],b.appendChild(g),document.createElement("i"));g.className="bi bi-info-circle info-circle-pac",g.name="referenceInfo",g.role="button",g.setAttribute("data-bs-toggle","popover"),g.setAttribute("data-bs-title","Loading..."),g.setAttribute("data-bs-content","Fetching data of reference."),g.setAttribute("data-reference-info",JSON.stringify(u)),b.appendChild(g),h.appendChild(b),m.appendChild(h)}a.appendChild(m),r.appendChild(a);l=document.createElement("td");l.className="d-none d-lg-table-cell d-xl-table-cell";try{l.textContent=e.comm.substring(0,100)}catch(e){l.textContent=""}r.appendChild(l);let f=new Date(1e3*e.time),C="00"+f.getUTCHours(),_=(C=C.substring(C.length-2,C.length),"00"+f.getMinutes()),E=(_=_.substring(_.length-2,_.length),"00"+f.getUTCDate()),x=(E=E.substring(E.length-2,E.length),"00"+(Number(f.getUTCMonth())+1));x=x.substring(x.length-2,x.length);o=f.getUTCFullYear(),s=C+":"+_,f=E+"/"+x+"/"+o,c=document.createElement("td"),i=document.createElement("div"),i.textContent=s,c.appendChild(i),f!=n&&((p=document.createElement("div")).textContent=f,c.appendChild(p)),r.appendChild(c),d=document.createElement("td");return d.className="d-none d-lg-table-cell d-xl-table-cell",d.textContent=e.source,r.appendChild(d),r}build(n,a){if(null!=n){var r=new Date;let e="00"+r.getUTCDate(),t=(e=e.substring(e.length-2,e.length),"00"+(Number(r.getUTCMonth())+1));t=t.substring(t.length-2,t.length);var r=r.getUTCFullYear(),l=e+"/"+t+"/"+r,o=(document.getElementById(this.selector).replaceChildren(),[]);for(let e=0;e<n.length;e++)document.getElementById(this.selector).append(this.#buildRow(n[e],!0,l,a)),o.push(n[e]);for(let e=0;e<this.current_data.length-n.length;e++)document.getElementById(this.selector).append(this.#buildRow(this.current_data[e],!1,l,a)),o.push(this.current_data[e]);this.current_data=o;[].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]')).map(function(e){return new bootstrap.Popover(e)});document.querySelectorAll(".info-circle-pac").forEach(e=>e.addEventListener("show.bs.popover",referenceInfoHandler)),this.first_time=!1}}}const adxo_url="https://www.ng3k.com/misc/adxo.html",qrz_url="https://www.qrz.com/db/",tb=new table_builder("bodyspot");var params_sv={};const cors_proxy_url="https://corsproxy.io/?",gma_url="https://www.cqgma.org/api/";function referenceInfoHandler(e){var t,n,a,r;this.hasAttribute("data-reference-details-loaded")||(console.log("referenceInfoHandler called"),t=bootstrap.Popover.getInstance(this),n=JSON.parse(this.dataset.referenceInfo),r=gma_url+n[0].toLowerCase()+"/?"+n[1],(a=new XMLHttpRequest).open("GET",r,!1),a.send(null),200===a.status?(console.log(a.responseText),r=JSON.parse(a.responseText),t.setContent({".popover-header":r.ref,".popover-body":r.name}),this.setAttribute("data-reference-details-loaded",!0)):t.setContent({".popover-header":n[0],".popover-body":n[1]}))}function findAdxo(t,n){if(t)for(let e=0;e<t.length;e++)if(t[e].callsign==n)return t[e]}function mySearch(e){e.preventDefault(),refresh_timer()}function compose_filter(t,e,n){var a=document.getElementById(t);if(null!=a)try{var r=[].map.call(document.getElementById(t).selectedOptions,e=>e.value);r.length<e?(n[t]=[],r.map(function(e){if(!e)return"";n[t].push(e)})):-1==e&&r.map(function(e){if(!e)return"";n[t]=e})}catch(e){if("TypeError"!=e.name)throw e;console.error(e.name)}return n}function refresh_timer(){var e=compose_filter("band",14,e={});e=compose_filter("de_re",7,e),e=compose_filter("dx_re",7,e),e=compose_filter("mode",3,e),e=compose_filter("cqdeInput",-1,e),e=compose_filter("cqdxInput",-1,e),delete params_sv.lr,JSON.stringify(e)!==JSON.stringify(params_sv)&&(tb.resetData(),params_sv=e),e.lr=tb.getLastRowId(),fetch("spotlist",{method:"POST",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(t=>{try{tb.build(t)}catch(e){console.log(e),console.log(e.stack),console.log(t)}})}
